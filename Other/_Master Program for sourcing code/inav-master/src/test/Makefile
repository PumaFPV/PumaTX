# A sample Makefile for building Google Test and using it in user
# tests.  Please tweak it to suit your environment and project.  You
# may want to move it to your project's root directory.
#
# SYNOPSIS:
#
#   make [all]  - makes everything.
#   make TARGET - makes the given target.
#   make clean  - removes all files generated by make.

# Please tweak the following variable definitions as needed by your
# project, except GTEST_HEADERS, which you can use in your own targets
# but shouldn't modify.

# Points to the root of Google Test, relative to where this file is.
# Remember to tweak this if you move this file.
GTEST_DIR = ../../lib/test/gtest

# Where to find user code.
USER_DIR = ../main
TEST_DIR = unit
USER_INCLUDE_DIR = $(USER_DIR)

OBJECT_DIR = ../../obj/test

COMMON_FLAGS = \
	-g \
	-Wall \
	-pthread \
	-Wextra \
	-ggdb3 \
	-O0 \
	-DUNIT_TEST \
	-isystem $(GTEST_DIR)/inc \
	-MMD -MP

# Flags passed to the C compiler.
C_FLAGS = $(COMMON_FLAGS) \
	-std=gnu99

# Flags passed to the C++ compiler.
CXX_FLAGS = $(COMMON_FLAGS) \
	-std=gnu++11

# Gather up all of the tests.
TEST_SRC = $(sort $(wildcard $(TEST_DIR)/*.cc))
TESTS = $(TEST_SRC:$(TEST_DIR)/%.cc=%)
TEST_BINARIES = $(TESTS:%=$(OBJECT_DIR)/%)

# All Google Test headers.  Usually you shouldn't change this
# definition.
GTEST_HEADERS = $(GTEST_DIR)/inc/gtest/*.h

# House-keeping build targets.

all : $(TEST_BINARIES)

clean :
	rm -rf $(OBJECT_DIR)

# Builds gtest.a and gtest_main.a.

# Usually you shouldn't tweak such internal variables, indicated by a
# trailing _.
GTEST_SRCS_ = $(GTEST_DIR)/src/*.cc $(GTEST_DIR)/inc/gtest/*.h $(GTEST_HEADERS)

# For simplicity and to avoid depending on Google Test's
# implementation details, the dependencies specified below are
# conservative and not optimized.  This is fine as Google Test
# compiles fast and for ordinary users its source rarely changes.
$(OBJECT_DIR)/gtest-all.o : $(GTEST_SRCS_)
	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) -I$(GTEST_DIR) -Wno-missing-field-initializers -Wno-unused-const-variable -c \
            $(GTEST_DIR)/src/gtest-all.cc -o $@

$(OBJECT_DIR)/gtest_main.o : $(GTEST_SRCS_)
	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) -I$(GTEST_DIR) -c \
            $(GTEST_DIR)/src/gtest_main.cc -o $@

$(OBJECT_DIR)/gtest.a : $(OBJECT_DIR)/gtest-all.o
	$(AR) $(ARFLAGS) $@ $^

$(OBJECT_DIR)/gtest_main.a : $(OBJECT_DIR)/gtest-all.o $(OBJECT_DIR)/gtest_main.o
	$(AR) $(ARFLAGS) $@ $^

# Builds a sample test.  A test should link with either gtest.a or
# gtest_main.a, depending on whether it defines its own main()
# function.

# includes in test dir must override includes in user dir
TEST_INCLUDE_DIRS := $(TEST_DIR) \
	$(USER_INCLUDE_DIR)

TEST_CFLAGS	 = $(addprefix -I,$(TEST_INCLUDE_DIRS))

DEPS = $(TEST_BINARIES:%=%.d)

$(OBJECT_DIR)/common/maths.o : \
	$(USER_DIR)/common/maths.c \
	$(USER_DIR)/common/maths.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/common/maths.c -o $@


$(OBJECT_DIR)/common/calibration.o : \
	$(USER_DIR)/common/calibration.c \
	$(USER_DIR)/common/calibration.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/common/calibration.c -o $@


$(OBJECT_DIR)/common/bitarray.o : \
	$(USER_DIR)/common/bitarray.c \
	$(USER_DIR)/common/bitarray.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/common/bitarray.c -o $@


$(OBJECT_DIR)/common/string_light.o : \
	$(USER_DIR)/common/string_light.c \
	$(USER_DIR)/common/string_light.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/common/string_light.c -o $@


$(OBJECT_DIR)/sensors/battery.o : $(USER_DIR)/sensors/battery.c $(USER_DIR)/sensors/battery.h $(GTEST_HEADERS)
	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/sensors/battery.c -o $@

$(OBJECT_DIR)/battery_unittest.o : \
	$(TEST_DIR)/battery_unittest.cc \
	$(USER_DIR)/sensors/battery.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $< -o $@

$(OBJECT_DIR)/battery_unittest : \
	$(OBJECT_DIR)/sensors/battery.o \
	$(OBJECT_DIR)/common/maths.o \
	$(OBJECT_DIR)/battery_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $@

$(OBJECT_DIR)/common/encoding.o : $(USER_DIR)/common/encoding.c $(USER_DIR)/common/encoding.h $(GTEST_HEADERS)
	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/common/encoding.c -o $@

$(OBJECT_DIR)/encoding_unittest.o : \
	$(TEST_DIR)/encoding_unittest.cc \
	$(USER_DIR)/common/encoding.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/encoding_unittest.cc -o $@

$(OBJECT_DIR)/encoding_unittest : \
	$(OBJECT_DIR)/common/encoding.o \
	$(OBJECT_DIR)/encoding_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/flight/imu.o : \
	$(USER_DIR)/flight/imu.c \
	$(USER_DIR)/flight/imu.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/flight/imu.c -o $@

$(OBJECT_DIR)/common/filter.o : \
	$(USER_DIR)/common/filter.c \
	$(USER_DIR)/common/filter.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/common/filter.c -o $@

$(OBJECT_DIR)/flight_imu_unittest.o : \
	$(TEST_DIR)/flight_imu_unittest.cc \
	$(USER_DIR)/flight/imu.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/flight_imu_unittest.cc -o $@

$(OBJECT_DIR)/flight_imu_unittest : \
	$(OBJECT_DIR)/flight/imu.o \
	$(OBJECT_DIR)/flight_imu_unittest.o \
    $(OBJECT_DIR)/common/filter.o \
	$(OBJECT_DIR)/common/maths.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/maths_unittest.o : \
	$(TEST_DIR)/maths_unittest.cc \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/maths_unittest.cc -o $@

$(OBJECT_DIR)/maths_unittest : \
	$(OBJECT_DIR)/maths_unittest.o \
	$(OBJECT_DIR)/common/maths.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@


$(OBJECT_DIR)/common/gps_conversion.o : \
	$(USER_DIR)/common/gps_conversion.c \
	$(USER_DIR)/common/gps_conversion.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/common/gps_conversion.c -o $@

$(OBJECT_DIR)/gps_conversion_unittest.o : \
	$(TEST_DIR)/gps_conversion_unittest.cc \
	$(USER_DIR)/common/gps_conversion.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/gps_conversion_unittest.cc -o $@

$(OBJECT_DIR)/gps_conversion_unittest : \
	$(OBJECT_DIR)/common/gps_conversion.o \
	$(OBJECT_DIR)/gps_conversion_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@



$(OBJECT_DIR)/telemetry/hott.o : \
	$(USER_DIR)/telemetry/hott.c \
	$(USER_DIR)/telemetry/hott.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/telemetry/hott.c -o $@

$(OBJECT_DIR)/telemetry_hott_unittest.o : \
	$(TEST_DIR)/telemetry_hott_unittest.cc \
	$(USER_DIR)/telemetry/hott.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/telemetry_hott_unittest.cc -o $@

$(OBJECT_DIR)/telemetry_hott_unittest : \
	$(OBJECT_DIR)/telemetry/hott.o \
	$(OBJECT_DIR)/telemetry_hott_unittest.o \
	$(OBJECT_DIR)/common/gps_conversion.o \
	$(OBJECT_DIR)/common/string_light.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@



$(OBJECT_DIR)/fc/rc_controls.o : \
	$(USER_DIR)/fc/rc_controls.c \
	$(USER_DIR)/fc/rc_controls.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/fc/rc_controls.c -o $@

$(OBJECT_DIR)/fc/rc_modes.o : \
	$(USER_DIR)/fc/rc_modes.c \
	$(USER_DIR)/fc/rc_modes.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/fc/rc_modes.c -o $@

$(OBJECT_DIR)/rc_controls_unittest.o : \
	$(TEST_DIR)/rc_controls_unittest.cc \
	$(USER_DIR)/fc/rc_controls.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/rc_controls_unittest.cc -o $@

$(OBJECT_DIR)/rc_controls_unittest : \
	$(OBJECT_DIR)/common/maths.o \
	$(OBJECT_DIR)/io/rc_controls.o \
	$(OBJECT_DIR)/rc_controls_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@


$(OBJECT_DIR)/io/ledstrip.o : \
	$(USER_DIR)/io/ledstrip.c \
	$(USER_DIR)/io/ledstrip.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/io/ledstrip.c -o $@

$(OBJECT_DIR)/ledstrip_unittest.o : \
	$(TEST_DIR)/ledstrip_unittest.cc \
	$(USER_DIR)/io/ledstrip.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/ledstrip_unittest.cc -o $@

$(OBJECT_DIR)/ledstrip_unittest : \
	$(OBJECT_DIR)/io/ledstrip.o \
	$(OBJECT_DIR)/ledstrip_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@



$(OBJECT_DIR)/drivers/light_ws2811strip.o : \
	$(USER_DIR)/drivers/light_ws2811strip.c \
	$(USER_DIR)/drivers/light_ws2811strip.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/drivers/light_ws2811strip.c -o $@

$(OBJECT_DIR)/ws2811_unittest.o : \
	$(TEST_DIR)/ws2811_unittest.cc \
	$(USER_DIR)/drivers/light_ws2811strip.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/ws2811_unittest.cc -o $@

$(OBJECT_DIR)/ws2811_unittest : \
	$(OBJECT_DIR)/drivers/light_ws2811strip.o \
	$(OBJECT_DIR)/ws2811_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@


$(OBJECT_DIR)/flight/lowpass.o : \
	$(USER_DIR)/flight/lowpass.c \
	$(USER_DIR)/flight/lowpass.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/flight/lowpass.c -o $@

$(OBJECT_DIR)/lowpass_unittest.o : \
	$(TEST_DIR)/lowpass_unittest.cc \
	$(USER_DIR)/flight/lowpass.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/lowpass_unittest.cc -o $@

$(OBJECT_DIR)/lowpass_unittest : \
	$(OBJECT_DIR)/flight/lowpass.o \
	$(OBJECT_DIR)/lowpass_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/flight/mixer.o : \
	$(USER_DIR)/flight/mixer.c \
	$(USER_DIR)/flight/mixer.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/flight/mixer.c -o $@

$(OBJECT_DIR)/flight_mixer_unittest.o : \
	$(TEST_DIR)/flight_mixer_unittest.cc \
	$(USER_DIR)/flight/mixer.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/flight_mixer_unittest.cc -o $@

$(OBJECT_DIR)/flight_mixer_unittest : \
	$(OBJECT_DIR)/flight/mixer.o \
	$(OBJECT_DIR)/flight_mixer_unittest.o \
	$(OBJECT_DIR)/common/maths.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/flight/failsafe.o : \
	$(USER_DIR)/flight/failsafe.c \
	$(USER_DIR)/flight/failsafe.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/flight/failsafe.c -o $@

$(OBJECT_DIR)/flight_failsafe_unittest.o : \
	$(TEST_DIR)/flight_failsafe_unittest.cc \
	$(USER_DIR)/flight/failsafe.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/flight_failsafe_unittest.cc -o $@

$(OBJECT_DIR)/flight_failsafe_unittest : \
	$(OBJECT_DIR)/flight/failsafe.o \
	$(OBJECT_DIR)/flight_failsafe_unittest.o \
	$(OBJECT_DIR)/common/maths.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/io/serial.o : \
	$(USER_DIR)/io/serial.c \
	$(USER_DIR)/io/serial.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/io/serial.c -o $@

$(OBJECT_DIR)/io_serial_unittest.o : \
	$(TEST_DIR)/io_serial_unittest.cc \
	$(USER_DIR)/io/serial.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/io_serial_unittest.cc -o $@

$(OBJECT_DIR)/io_serial_unittest : \
	$(OBJECT_DIR)/io/serial.o \
	$(OBJECT_DIR)/io_serial_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/rx/rx.o : \
	$(USER_DIR)/rx/rx.c \
	$(USER_DIR)/rx/rx.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/rx/rx.c -o $@

$(OBJECT_DIR)/rx_rx_unittest.o : \
	$(TEST_DIR)/rx_rx_unittest.cc \
	$(USER_DIR)/rx/rx.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/rx_rx_unittest.cc -o $@

$(OBJECT_DIR)/rx_rx_unittest : \
	$(OBJECT_DIR)/rx/rx.o \
	$(OBJECT_DIR)/rx_rx_unittest.o \
	$(OBJECT_DIR)/common/maths.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/rx_ranges_unittest.o : \
	$(TEST_DIR)/rx_ranges_unittest.cc \
	$(USER_DIR)/rx/rx.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/rx_ranges_unittest.cc -o $@

$(OBJECT_DIR)/rx_ranges_unittest : \
	$(OBJECT_DIR)/rx/rx.o \
	$(OBJECT_DIR)/rx_ranges_unittest.o \
	$(OBJECT_DIR)/common/maths.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/drivers/barometer_ms56xx.o : \
    $(USER_DIR)/drivers/barometer_ms56xx.c \
    $(USER_DIR)/drivers/barometer_ms56xx.h \
    $(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/drivers/barometer_ms56xx.c -o $@

$(OBJECT_DIR)/baro_ms5611_unittest.o : \
	$(TEST_DIR)/baro_ms5611_unittest.cc \
	$(USER_DIR)/drivers/barometer_ms5611.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/baro_ms5611_unittest.cc -o $@

$(OBJECT_DIR)/baro_ms5611_unittest : \
	$(OBJECT_DIR)/drivers/barometer_ms5611.o \
	$(OBJECT_DIR)/baro_ms5611_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/drivers/barometer_bmp085.o : \
    $(USER_DIR)/drivers/barometer_bmp085.c \
    $(USER_DIR)/drivers/barometer_bmp085.h \
    $(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/drivers/barometer_bmp085.c -o $@

$(OBJECT_DIR)/baro_bmp085_unittest.o : \
	$(TEST_DIR)/baro_bmp085_unittest.cc \
	$(USER_DIR)/drivers/barometer_bmp085.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/baro_bmp085_unittest.cc -o $@

$(OBJECT_DIR)/baro_bmp085_unittest : \
	$(OBJECT_DIR)/drivers/barometer_bmp085.o \
	$(OBJECT_DIR)/baro_bmp085_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/drivers/barometer_bmp280.o : \
    $(USER_DIR)/drivers/barometer_bmp280.c \
    $(USER_DIR)/drivers/barometer_bmp280.h \
    $(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/drivers/barometer_bmp280.c -o $@

$(OBJECT_DIR)/baro_bmp280_unittest.o : \
	$(TEST_DIR)/baro_bmp280_unittest.cc \
	$(USER_DIR)/drivers/barometer_bmp280.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/baro_bmp280_unittest.cc -o $@

$(OBJECT_DIR)/baro_bmp280_unittest : \
	$(OBJECT_DIR)/drivers/barometer_bmp280.o \
	$(OBJECT_DIR)/baro_bmp280_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/drivers/rangefinder_hcsr04.o : \
        $(USER_DIR)/drivers/rangefinder_hcsr04.c \
        $(USER_DIR)/drivers/rangefinder_hcsr04.h \
        $(GTEST_HEADERS)
	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -DSONAR -c $(USER_DIR)/drivers/rangefinder_hcsr04.c -o $@

$(OBJECT_DIR)/sensors/sonar.o : \
	$(USER_DIR)/sensors/sonar.c \
	$(USER_DIR)/sensors/sonar.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -DSONAR -c $(USER_DIR)/sensors/sonar.c -o $@

$(OBJECT_DIR)/sonar_unittest.o : \
	$(TEST_DIR)/sonar_unittest.cc \
	$(USER_DIR)/drivers/rangefinder_hcsr04.h \
	$(USER_DIR)/sensors/sonar.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/sonar_unittest.cc -o $@

$(OBJECT_DIR)/sonar_unittest : \
	$(OBJECT_DIR)/common/maths.o \
	$(OBJECT_DIR)/drivers/rangefinder_hcsr04.o \
	$(OBJECT_DIR)/sensors/sonar.o \
	$(OBJECT_DIR)/sonar_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/sensors/boardalignment.o : \
	$(USER_DIR)/sensors/boardalignment.c \
	$(USER_DIR)/sensors/boardalignment.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/sensors/boardalignment.c -o $@

$(OBJECT_DIR)/alignsensor_unittest.o : \
	$(TEST_DIR)/alignsensor_unittest.cc \
	$(USER_DIR)/sensors/boardalignment.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/alignsensor_unittest.cc -o $@

$(OBJECT_DIR)/alignsensor_unittest : \
	$(OBJECT_DIR)/common/maths.o \
	$(OBJECT_DIR)/sensors/boardalignment.o \
	$(OBJECT_DIR)/alignsensor_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/build/debug.o : \
	$(USER_DIR)/build/debug.c \
	$(USER_DIR)/build/debug.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/build/debug.c -o $@

$(OBJECT_DIR)/drivers/accgyro/accgyro_fake.o : \
	$(USER_DIR)/drivers/accgyro/accgyro_fake.c \
	$(USER_DIR)/drivers/accgyro/accgyro_fake.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/drivers/accgyro/accgyro_fake.c -o $@

$(OBJECT_DIR)/sensors/gyro.o : \
	$(USER_DIR)/sensors/gyro.c \
	$(USER_DIR)/sensors/gyro.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/sensors/gyro.c -o $@

$(OBJECT_DIR)/sensor_gyro_unittest.o : \
	$(TEST_DIR)/sensor_gyro_unittest.cc \
	$(USER_DIR)/sensors/gyro.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/sensor_gyro_unittest.cc -o $@

$(OBJECT_DIR)/sensor_gyro_unittest : \
	$(OBJECT_DIR)/build/debug.o \
	$(OBJECT_DIR)/common/maths.o \
	$(OBJECT_DIR)/common/calibration.o \
	$(OBJECT_DIR)/common/filter.o \
	$(OBJECT_DIR)/drivers/accgyro/accgyro_fake.o \
	$(OBJECT_DIR)/sensors/gyro.o \
	$(OBJECT_DIR)/sensors/boardalignment.o \
	$(OBJECT_DIR)/sensor_gyro_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/common/crc.o : \
	$(USER_DIR)/common/crc.c \
	$(USER_DIR)/common/crc.h

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/common/crc.c -o $@

$(OBJECT_DIR)/io/rcdevice.o : \
	$(USER_DIR)/io/rcdevice.c \
	$(USER_DIR)/io/rcdevice.h

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -DUSE_RCDEVICE -c $(USER_DIR)/io/rcdevice.c -o $@

$(OBJECT_DIR)/io/rcdevice_cam.o : \
	$(USER_DIR)/io/rcdevice.c \
	$(USER_DIR)/io/rcdevice.h \
	$(USER_DIR)/io/rcdevice_cam.c \
	$(USER_DIR)/io/rcdevice_cam.h

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -DUSE_RCDEVICE -c $(USER_DIR)/io/rcdevice_cam.c -o $@


$(OBJECT_DIR)/rcdevice_unittest.o : \
	$(TEST_DIR)/rcdevice_unittest.cc \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -DUSE_RCDEVICE -c $(TEST_DIR)/rcdevice_unittest.cc -o $@

$(OBJECT_DIR)/rcdevice_unittest : \
	$(OBJECT_DIR)/rcdevice_unittest.o \
	$(OBJECT_DIR)/common/bitarray.o \
	$(OBJECT_DIR)/common/crc.o \
	$(OBJECT_DIR)/io/rcdevice.o \
	$(OBJECT_DIR)/io/rcdevice_cam.o \
	$(OBJECT_DIR)/fc/rc_modes.o \
	$(OBJECT_DIR)/rx/rx.o \
	$(OBJECT_DIR)/common/maths.o \
	$(OBJECT_DIR)/gtest_main.a 

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/drivers/system.o : \
	$(USER_DIR)/drivers/system.c \
	$(USER_DIR)/drivers/system.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/drivers/system.c -o $@

$(OBJECT_DIR)/time_unittest.o : \
	$(TEST_DIR)/time_unittest.cc \
	$(USER_DIR)/drivers/system.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/time_unittest.cc -o $@

$(OBJECT_DIR)/time_unittest : \
	$(OBJECT_DIR)/drivers/system.o \
	$(OBJECT_DIR)/time_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/bitarray_unittest.o : \
	$(TEST_DIR)/bitarray_unittest.cc \
	$(USER_DIR)/common/bitarray.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/bitarray_unittest.cc -o $@

$(OBJECT_DIR)/bitarray_unittest : \
	$(OBJECT_DIR)/common/bitarray.o \
	$(OBJECT_DIR)/bitarray_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@

$(OBJECT_DIR)/common/olc.o : $(USER_DIR)/common/olc.c $(USER_DIR)/common/olc.h $(GTEST_HEADERS)
	@mkdir -p $(dir $@)
	$(CC) $(C_FLAGS) $(TEST_CFLAGS) -c $(USER_DIR)/common/olc.c -o $@

$(OBJECT_DIR)/olc_unittest.o : \
	$(TEST_DIR)/olc_unittest.cc \
	$(USER_DIR)/common/olc.h \
	$(GTEST_HEADERS)

	@mkdir -p $(dir $@)
	$(CXX) $(CXX_FLAGS) $(TEST_CFLAGS) -c $(TEST_DIR)/olc_unittest.cc -o $@

$(OBJECT_DIR)/olc_unittest : \
	$(OBJECT_DIR)/common/olc.o \
	$(OBJECT_DIR)/olc_unittest.o \
	$(OBJECT_DIR)/gtest_main.a

	$(CXX) $(CXX_FLAGS) $^ -o $(OBJECT_DIR)/$@



test: $(TESTS:%=test-%)

test-%: $(OBJECT_DIR)/%
	$<

-include $(DEPS)

